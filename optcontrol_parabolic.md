# Оптимальное управление параболическими уравнениями

## Введение

Источник:

[Frechet Differentiability in Optimal Control of Parabolic PDEs - Part 1](https://youtu.be/ZrzK51QeN4A) (Florida Institute of Technology)

[Frechet Differentiability in Optimal Control of Parabolic PDEs - Part 2](https://youtu.be/GK4Ftg4WRZI) (Florida Institute of Technology)

[Текстовые материалы лекций FIT](http://my.fit.edu/~abdulla/lect/isp.htm)

[Перевод 1](https://youtu.be/Tk0AHZ0kwJs)


Теория оптимального управления - это обобщение классического вариационного исчисления, в котором минимизация производится в классе гладких функций. Требуется минимизировать некоторую величину (функционал) в классе негладких функций. Здесь классические методы вариационного исчисления не работают.

В XX веке теория оптимального управления была существенно развита. Теория для ОДУ полностью разработана, и её основной результат -- принцип максимума Понтрягина.
Теория оптимального управления системами, описываемыми ДУЧП, тоже развивалась, но не завершена. Здесь нет такого общего результата, как принцип максимума Понтрягина.

Рассмотрим пример задачи оптимального управления для параболического уравнения 2-го порядка.

### Постановка задачи

Требуется минимизировать функционал
$$
\tag{1}J(v) = \int_0^l |u(x, T; v) - f(x)|^2\,dx \to \min.
$$
Здесь $$v \in V$$ -- управление,

$$V = \{v = (p, f) \colon p \in L^2(0,T), f \in L^2(Q),
p_{min} \leq p(t) \leq p_{max} \;\mbox{п.в. на}\;(0,T),
\|f\|_{L^2(Q)} \leq R \}$$,

$$Q = \{(x,t) \colon 0 < x < l, \; 0 < t \leq T\}$$

По заданному $$v$$ мы должны определить $$u$$.

Пусть $$u = u(x, t; v)$$ -- решение следующей начально-краевой задачи:
$$
\tag{2}\frac{\partial u}{\partial t} = a^2 \frac{\partial^2 u}{\partial^2 x} + f(x, t),\quad (x,t) \in Q
$$

$$
\tag{3}\frac{\partial u(0, t)}{\partial x} = 0,\quad
\frac{\partial u(l, t)}{\partial x} = \nu[p(t) - u(l, t)],\; 0 < t < T,
$$

$$
\tag{4}u(x,0) = \phi(x),\; 0 \leq x \leq l.
$$

Исходные данные: $$p_{min}, p_{max}, \nu > 0, T > 0, f(x) \in L^2(0, l), \phi \in L^2(0, l), a > 0$$.

Это задача из теплофизики. Допустим, что у нас есть 1-мерный стержень длины $$l$$. В стержне происходит кондуктивный перенос тепла.

Мы управляем этим процессом. Идёт процесс теплопроводности, но внутри могут быть разные источники тепла. Функция $$f(x,t)$$ описывает плотность источников внутри стержня, которая может меняться по $$x$$ и $$t$$.

Функция $$p(t)$$ описывает температуру внешней среды на правом конце. Мы можем увеличивать или уменьшать температуру вблизи правого конца.

Итак, мы можем изменять источники и температуру в условии Робина, и мы наблюдаем температуру в конечный момент времени. Цель -- чтобы эта температура была максимально близкой к желаемой температуре $$f(x)$$.

Это задача оптимального управления, которая эквивалентна обратной задаче для ДУЧП. Представим, что мы решаем уравнение теплопроводности. Если функции $$p$$, $$f$$ известны, задача имеет единственное решение. Но на самом деле мы не знаем $$f$$, $$p$$. Раз мы их не знаем, нам нужно дополнительное условие -- мы можем измерять температуру в конечный момент времени.

### Слабое решение начально-краевой задачи

Нам потребуется уточнить, как мы понимаем решение этой задачи. Мы решаем ДУЧП с негладкими данными, и классическое решение не существует. Будет решение в слабом смысле.

Введем гильбертово пространство $$H = L^2(0,T) \times L^2(Q)$$.

Скалярное произведение: $$\langle v_1, v_2 \rangle = \int_0^T p_1(t)p_2(t)\,dt + \int_0^T\int_0^l f_1(x,t)f_2(x,t)\,dxdt$$.

Норма: $$\|v\| = \langle v, v \rangle^{1/2}$$.

Как понимать решение диффура?

Введем определения пространств Соболева.

$$W_2^{1,0}(Q)$$ -- гильбертово пространство функций $$u \in L^2(Q)$$ таких, что слабая производная $$u_x \in L^2(Q)$$.

Скалярное произведение в этом пространстве: $$\langle u, v\rangle = \int_0^T \int_0^l (uv + u_xv_x)\,dxdt$$.

$$W_2^{1,1}(Q)$$ -- гильбертово пространство функций $$u \in L^2(Q)$$ таких, что $$u_x, u_t \in L^2(Q)$$.

Скалярное произведение в этом пространстве: $$\langle u, v\rangle = \int_0^T \int_0^l (uv + u_xv_x + u_tv_t)\,dxdt$$.

$$V_2(Q)$$ -- банахово пространство функций $$u \in W_2^{1,0}(Q)$$ с конечной нормой

$$
\|u\|_{V_2(Q)} = \left( {\rm ess}\sup_{0\leq t\leq T} \|u(x,t)\|_{L^2(0,l)}^2 + \|u_x\|^2_{L^2(Q)} \right)^{1/2},
$$

$$V_2^{1,0}(Q)$$ -- банахово пространство -- пополнение (замыкание) $$W_2^{1,1}(Q)$$ по норме $$V_2(Q)$$,
$$
\|u\|_{V_2^{1,0}(Q)} = \left( \max_{0\leq t\leq T} \|u(x,t)\|_{L^2(0,l)}^2 + \|u_x\|^2_{L^2(Q)} \right)^{1/2} < +\infty.
$$

Здесь функция $$t \mapsto u(x, t)$$ непрерывна (см. определение $$W_2^{1,1}(Q)$$), поэтому можно написать $$\max$$.


Заменим ДУЧП интегральным тождеством.
Предположим, что задача имеет гладкое решение. Проинтегрируем уравнение (2), умноженное на тестовую функцию $$\psi$$ и применим формулу интегрирования по частям (по $$t$$ и один раз по $$x$$) и учтем условия (3), (4).

$$
0 = \int_0^T \int_0^l (u_t - a^2u_{xx} - f)\psi\,dxdt =
$$

$$
=\int_0^T \int_0^l (-u\psi_t + a^2 u_x\psi_x - f\psi)dxdt +
$$

$$
+ \int_0^l u(x,T)\psi(x,T)\,dx - \int_0^l \phi(x)\psi(x,0)\,dx -
$$

$$
\tag{5}
- a^2\nu \int_0^T [p(t) - u(l,t)]\psi(l,t)\,dt\quad \forall \psi \in W^{1,1}_2(Q).
$$

Итак, если уравнение имеет классическое решение, то данное выражение равно 0 для любой функции $$\psi$$ такой, что $$\psi_t \in L^2,\; \psi_x \in L^2$$.

Даже если уравнение не имеет гладкого решения, интегральное тождество имеет смысл.

**Определение.** Функция $$u \in V_2^{1,0}(Q)$$ называется слабым решением задачи (2)-(4), если $$u$$ удовлетворяет (5) для любой функции $$\psi \in W_2^{1,1}(Q)$$.


#### Корректность начально-краевой задачи

**Теорема.** [Ладыженская, Солонников, Уральцева, "Линейные и квазилинейные уравнения параболического типа"]
Пусть $$v \in H$$, $$\phi \in L^2(0,l)$$. Тогда существует единственное слабое решение $$u \in V_2^{1,0}(Q)$$ задачи (2)-(4), и для него справедлива энергетическая оценка
$$
\|u\|_{V_2^{1,0}(Q)} \leq C\left( \|f\|_{L^2(Q)} + \|p\|_{L^2(0,T)} + \|\phi\|_{L^2(0,l)} \right).
$$


### Задача оптимального управления

#### Разрешимость задачи оптимального управления

**Теорема.** Задача оптимального управления имеет решение.

*Доказательство* основано на теореме Вейерштрасса: непрерывная функция, определенная на компакте, имеет максимум и минимум. Более общий результат имеет место, когда множество управлений -- ограниченное множество в гильбертовом пространстве. В общем случае множество не компактно, но слабо компактно. Чтобы применить теорему Вейерштрасса, нужно доказать, что функционал $$J$$ слабо непрерывен. Слабая непрерывность -- это более сильное требование, чем непрерывность.


#### Дифференцируемость по Фреше

Как мы понимаем производную в бесконечномерном пространстве?

**Определение.** Пусть $$B$$ -- банахово пространство, $$u \in B$$. Пусть $$J$$ -- функционал, определенный на окрестности точки $$u$$: $$B_\varepsilon(u) = \{ v \in B \colon \|v - u\| < \varepsilon\}$$.
$$J$$ дифференцируем по Фреше в точке $$u$$, если существует элемент $$J'(u) \in B^*$$ такой, что
$$
\Delta J(u) \equiv J(u+h) - J(u) = \langle J'(u), h \rangle_B + o(h, u),
$$
где $$\|h\| < \varepsilon, \; \dfrac{o(h, u)}{\|h\|} \to 0$$ при $$\|h\| \to 0$$;
$$B^*$$ -- пространство, сопряженное (двойственное) к $$B$$, т.е. пространство линейных непрерывных функционалов, определенных на $$B$$.

$$dJ(u) = \langle J'(u), h \rangle_B$$ -- дифференциал Фреше (главная линейная часть приращения функционала $$J$$).

**Замечание.** Пусть $$B = H$$ -- гильбертово пространство.
По теореме Рисса каждому линейному непрерывному функционалу из $$H^*$$ соответствует элемент из $$H$$. Здесь $$\langle J'(u), h \rangle_H$$ -- скалярное произведение в $$H$$.

Вычислим градиент функционала $$J$$.
$$
\Delta J(v) = J(v + \Delta v) - J(v) =
$$
$$
= \int_0^l |u(x, T; v + \Delta v) - f(x)|^2\,dx -
\int_0^l |u(x, T; v) - f(x)|^2\,dx =
$$
$$
\tag{6}
= \int_0^l 2(u(x,T;v) - f(x))\Delta u(x,T)\,dx + \int_0^l |\Delta u(x, T)|^2\,dx,
$$
здесь $$\Delta u(x,t) = u(x,t;v+\Delta v) - u(x,t;v)$$.

Наша цель -- представить выражение в виде скалярного произведения некоторого элемента из $$H$$ на $$\Delta v \in H$$.

Запишем задачу для $$\Delta u$$. Мы обозначаем $$v = (p, f)$$, $$v + \Delta v = (p + \Delta p, f + \Delta f)$$.

$$
(\Delta u)_t = a^2(\Delta u)_{xx} + \Delta f \;\; \mbox{в}\;Q,
$$
$$
(\Delta u)_x(0,t) = 0, \quad (\Delta u)_x(l,t) = \nu[\Delta p - \Delta u(l, t)],
$$
$$
\Delta u(x,0) = 0.
$$

Запишем интегральное тождество для этой задачи. Здесь $$u \in V_2^{1,0}(Q)$$.

$$
\int_0^T \int_0^l (-\Delta u\psi_t + a^2\Delta u_x\psi_x - \Delta f \psi)\,dxdt +
$$

$$
\tag{7}
+ \int_0^l \psi(x,T)\Delta u(x,T)\,dx - a^2\nu\int_0^T [\Delta p(t) - \Delta u(l,t)]\psi(l,t)\,dt = 0 \;\; \forall \psi \in W_2^{1,1}(Q).
$$

Интуиция подсказывает, что градиент функционала $$J$$ определяется первым слагаемым в формуле (6), потому что второе слагаемое квадратичное, и оно не войдет в линейную часть приращения функционала.

Чтобы преобразовать выражение (6), заметим, что $$\psi$$ в формуле (7) -- произвольная функция, и формула (7) содержит слагаемое $$\int_0^l \psi(x,T)\Delta u(x,T)\,dx$$, аналогичное первому слагаемому в (6), и мы можем выбрать $$\psi$$ так, чтобы
$$
\tag{8}
\psi(x, T) = 2(u(x, T; v) - f(x)), \; 0 \leq x \leq l.
$$
Тогда первое слагаемое в (6) совпадет со вторым слагаемым в (7).
Это слагаемое нужно представить в виде скалярного произведения некоторого элемента пространства $$H$$ на $$\Delta v = (\Delta p, \Delta f)$$.

Из (7), (8) следует, что

$$
\int_0^l \psi(x,T)\Delta u(x,T)\,dx =
$$

$$
\tag{9}
= a^2\nu\int_0^T [\Delta p(t) - \Delta u(l,t)]\psi(l,t)\,dt
- \int_0^T \int_0^l (-\Delta u\psi_t + a^2\Delta u_x\psi_x - \Delta f \psi)\,dxdt.
$$

В градиент $$J$$ пойдут слагаемые $$a^2\nu\int_0^T \Delta p(t)\psi(l,t)\,dt$$ и
$$\int_0^T \int_0^l \Delta f \psi \,dxdt $$.
Итак, мы вычисляем градиент с помощью неизвестной функции $$\psi$$.
Интуиция подсказывает, что $$\psi$$ нужно выбрать так, чтобы остальные слагаемые в (9) обращались в 0 -- тогда мы получим формулу для градиента.

Если мы потребуем, чтобы остальные слагаемые обращались в 0, мы получим определение слабого решения ДУЧП относительно неизвестной функции $$\psi$$, а $$\Delta u$$ будет тестовой функцией (функции меняются ролями). Дальше нужно выписать задачу для функции $$\psi$$.

---

Если $$J'(v) = (\Gamma_1, \Gamma_2) \in H$$, то
$$
\Delta J = \langle J'(v), \Delta v\rangle = \int_0^T \Gamma_1(t)\Delta p(t)\,dt +
\int_0^T\int_0^l \Gamma_2(x,t)\Delta f(x,t)\,dxdt.
$$

Пусть $$\psi(x,T) = 2(u(x,T;v) - f(x)) \in L^2(0,l)$$.

$$
\int_0^l \psi(x,T)\Delta u(x,T)\,dx = a^2\nu\int_0^T \psi(l,t)\Delta p(t)\,dt +
\int_0^T\int_0^l\psi(x,t)\Delta f(x,t)\,dxdt +
$$

$$
+ \int_0^T\int_0^l(\Delta u\psi_t - a^2\Delta u_x\psi_x)\,dxdt - a^2\nu \int_0^T\Delta u(l,t)\psi(l,t)\,dt.
$$

Выберем $$\psi \in W_2^{1,1}(Q)$$ так, чтобы $$\psi(x,T) = 2(u(x,T;v) - f(x))$$,

$$
0 = \int_0^T\int_0^l(\Delta u\psi_t - a^2\Delta u_x\psi_x)\,dxdt - a^2\nu \int_0^T\Delta u(l,t)\psi(l,t)\,dt.
$$

Это определение слабого решения ДУЧП.
Формально:
$$
0 = \int_0^T\int_0^l (\psi_t + a^2\psi_{xx})\Delta u\,dxdt -
a^2\int_0^T [\psi_x(l,t) + \nu\psi(l,t)]\Delta u(l,t)]\,dt +
a^2\int_0^T \Delta u(0,t)\psi_x(0,t)\,dt.
$$

$$\psi \in W_2^{1,1}(Q)$$ -- решение сопряженной задачи:
$$
\tag{10}
\psi_t + a^2\psi_{xx} = 0,\quad 0 < x < l, \; 0 \leq t < T,
$$
$$
\tag{11}
\psi(x,T) = 2(u(x,t;v) - f(x)),\quad 0 \leq x \leq l,
$$
$$
\tag{12}
\psi_x(0,t) = 0,\;\; \psi_x(l,t) + \nu\psi(l,t) = 0,\quad 0 \leq t < T.
$$

Как мы понимаем решение этой задачи?

**Определение.** $$\psi \in W_2^{1,1}(Q)$$ -- слабое решение задачи (10)-(12), если
$$
\psi(x,T) = 2(u(x,T;v) - f(x)),
$$
$$
\int_0^T\int_0^l[\psi_t\eta - a^2\psi_x\eta_x]\,dxdt -
a^2\nu\int_0^T \psi(l,t)\eta(l,t)\,dt = 0\quad \forall \eta\in W_2^{1,0}(Q).
$$

Эта задача может не иметь решения.

Функция из $$W_2^{1,1}(Q)$$ имеет след из $$W_2^{1/2}(0,l)$$.
Пространство Бесова -- более регулярное, чем $$L^2$$.

$$\psi$$ не обязательно будет из $$W_2^{1,1}$$, потому что $$\psi(x,T) = 2(u(x,T;v) - f(x))$$ ($$f(x)$$ -- заданная функция из $$L^2$$) -- не обязательно из $$W_2^{1/2}(0,l)$$.

Аппроксимируем $$\psi$$ гладкими функциями.

**Определение.** $$\psi \in V_2^{1,0}(Q)$$ -- слабое решение (10)-(12), если
$$
\int_0^T\int_0^l[-\psi\eta_t - a^2\psi_x\eta_x]\,dxdt -
a^2\nu\int_0^T \psi(l,t)\eta(l,t)\,dt + \int_0^l \psi(x,T)\eta(x,T)\,dx -
\int_0^l \psi(x,0)\eta(x,0)\,dx \quad \forall \eta\in W_2^{1,1}(Q).
$$
(более узкий класс тестовых функций)

Существует единственное решение $$\psi \in V_2^{1,0}(Q): \|\psi\|_{V_2^{1,0}(Q)} \leq C\|2(u,T;v) - f(x)\|_{L^2(0,l)}$$ [Ладыженская, Солонников, Уральцева].

Здесь $$\psi_t$$ не из $$L^2$$.

*Аппроксимация:*

Пусть $$\{g_n\}$$ -- последовательность гладких функций:
$$
\|g_n - 2(u(x,T;v) - f(x))\|_{L^2(0,l)} \to 0,\;\; n \to \infty.
$$

$$\psi_n = \psi_n(x,t)$$:
$$
\psi_t + a^2\psi_xx = 0 \;\;\mbox{в}\;Q
$$
$$
\psi(x,T) = g_n(x),
$$
$$
\psi_x(0,t) = 0,\;\; \psi_x(l,t) + \nu\psi(l,t) = 0.
$$
Существует единственное классическое решение $$\psi_n \in C_{x,t}^{2,1}(Q)$$ [Ладыженская, Солонников, Уральцева].

$$
\|\psi_n - \psi\|_{V_2^{1,0}(Q)} \leq C\|g_n - 2(u(x,T;v) - f(x))\|_{L^2(0,T)} \to 0,\;\; n\to\infty.
$$

Если мы выберем в интегральном тождестве для $$\Delta u$$, $$\psi = \psi_n(x,t)$$, то мы получим

$$
\int_0^l g_n(x)\Delta u(x,t)\,dx = a^2\nu \int_0^T \psi_n(l,t)\Delta p(t)\,dt +
\int_0^T \int_0^l \psi_n(x,t)\Delta f(x,t)\,dxdt +
$$

$$
+ \int_0^T\int_0^l(\Delta u\psi_{nt} - a^2\Delta u_x\psi_{nx})dxdt -
a^2\nu\int_0^T \Delta u(l,t)\psi_n(l,t)\,dt.
$$

Здесь $$\psi_n$$ -- это гладкое решение этой задачи (в частности, из $$W_2^{1,1}$$).

$$n\to\infty \;\Rightarrow\; \psi_n\to\psi$$ в $$V_2^{1,0}(Q)$$ $$\Rightarrow\; \psi_n(x,t) \to \psi$$ в $$L^2(Q)$$, $$\psi_n(l,t) \to \psi$$ в $$L^2(0,T)$$.
$$g_n(x) \to 2(u(x,T;v) - f(x)) \;\mbox{в}\; L^2(0,l)$$

В пределе получаем:
$$
\int_0^l |\Delta u(x,T)|^2\,dx \leq C\|\Delta u\|_{V_2^{1,0}(Q)}^2 \leq
C(\|\Delta p\|_{L^2(0,T)}^2 + \|\Delta f\|_{L^2(Q)}^2) = C\|\Delta v\|_H^2 = o(\|v\|_H).
$$

$$
J'(v) = \{a^2\nu\psi(l,t), \psi(x,t)\} \in H.
$$


## Условия оптимальности

Источник:

[Frechet Differentiability and Optimality Condition - Part 4](https://youtu.be/1xm1tySySyE) (Florida Institute of Technology)


$$U \subset B$$ -- выпуклое множество, если
$$\forall u, v \in U,\; \alpha \in [0,1]$$: $$\alpha u + (1 - \alpha)v \in U$$.

$$J \cdot U \to \mathbb R$$ -- выпуклый функционал, если
$$J(\alpha u + (1-\alpha)v) \leq \alpha J(u) + (1-\alpha)J(v)\;\; \forall u,v\in U,\;
\forall \alpha\in[0,1]$$.
(график ниже хорды)

Докажем, что $$J$$ из предыдущей части -- выпуклый.

$$
u(x,t;\alpha v + (1-\alpha)w) = \alpha u(x,t;v) + (1-\alpha) u(x,t;w)
$$

$$
J(\alpha v + (1-\alpha)w) = \int_0^l |u(x,T;\alpha v + (1-\alpha)w) - f(x)|^2\,dx =
\int_0^l |\alpha (u(x,T;v) - f(x)) + (1-\alpha)(u(x,T;w) - f(x))|^2\,dx =
$$

$$
= \langle \alpha (u(x,t;v) - f(x)) + (1-\alpha)(u(x,T;w) - f(x)),
\alpha (u(x,t;v) - f(x)) + (1-\alpha)(u(x,T;w) - f(x)) \rangle =
$$

$$
= \alpha^2 \int_0^T |u(x,T;v) - f(x)|^2\,dx +
(1-\alpha)^2\int_0^T |u(x,T;w) - f(x)|^2\,dx +
$$

$$
+ 2\alpha(1-\alpha)\langle u(x,T;v) - f(x), u(x,T;w) - f(x) \rangle =
$$

$$
= \alpha J(v) + (1-\alpha)J(w) - \alpha(1-\alpha)\langle u(x,T;v)-f(x), u(x,T;v)-f(x)\rangle -
$$

$$
- \alpha(1-\alpha)\langle u(x,T;w) - f(x), u(x,T;w) - f(x)\rangle
+ 2\alpha(1-\alpha)\langle u(x,T;v) - f(x), u(x,T;w) - f(x) \rangle =
$$

$$
= \alpha J(v) + (1-\alpha)J(w) - \alpha(1-\alpha)\|u(x,T; v-w)\|^2_{L^2(0,l)} \leq \alpha J(v) + (1-\alpha)J(w).
$$

**Теорема (необходимые условия оптимальности).**
Пусть $$U$$ -- выпуклое множество в банаховом пространстве $$B$$,
$$J \in C^1(U)$$ (непрерывно дифференцируем по Фреше).

Пусть $$U_* = \{u \in U \colon J(u) = J_* = \inf\limits_U J(u)\}$$.
Тогда если $$u_* \in U_*$$, то
$$
\tag{*}
\langle J'(u_*), u - u_*\rangle \geq 0\;\; \forall u \in U.
$$
Если, кроме того, $$u_* \in {\rm int}\, U$$, то
$$
J'(u_*) = 0.
$$
Более того, если $$J(u)$$ -- выпуклый, то (*) -- необходимое и достаточное условие.

**Доказательство.**

$$u_* \in U_* : J(u) \geq J(u_*) \;\forall u\in U$$.

Возьмем $$\forall u \in U,\; \alpha u + (1 - \alpha)u_* = u_* + \alpha(u - u_*) \in U$$, если $$\alpha \in [0,1]$$.

$$0 \leq J(u_* + \alpha(u - u_*)) - J(u_*) = \langle J'(u_*), \alpha(u - u_*)\rangle + o(\alpha)$$.

Разделим на $$\alpha$$:
$$
0 \leq \langle J'(u_*), u - u_*\rangle + \frac{o(\alpha)}{\alpha}.
$$
При $$\alpha \to 0$$ получаем (*).

Если $$u_* \in \mathrm{int}\, U$$, то $$\forall e \in B, \|e\| = 1: \exists\varepsilon_0 > 0 \colon u_* + \varepsilon e \in U \; \forall \varepsilon, \vert\varepsilon\vert \leq \varepsilon_0$$.

$$(*) \Rightarrow 0 \leq \langle J'(u_*), u_* + \varepsilon e - u_*\rangle = \varepsilon\langle J'(u_*), e\rangle
\Rightarrow \langle J'(u_*), e\rangle = 0 \Rightarrow J'(u_*) = 0.$$

Здесь $$e$$ -- любой элемент на единичной сфере.

Для доказательства достаточности докажем

**Утверждение.** $$J(u) \in C^1(U)$$ выпуклый $$\Leftrightarrow \; J(u) \geq J(v) + \langle J'(v), u - v\rangle\; \forall u, v \in U$$.

$$\Rightarrow$$:

$$J(u)$$ -- выпуклый $$\Rightarrow \; J(u) \geq J(v) + \langle J'(v), u - v \rangle \; \forall u, v \in U$$

По определению выпуклости, $$J(\alpha u + (1 - \alpha)v) \leq \alpha J(u) + (1-\alpha)J(v) \Rightarrow J(v + \alpha(u - v)) - J(v) \leq \alpha(J(u) - J(v))$$

По теореме о промежуточном значении,
$$
\langle J'(v + \theta\alpha(u - v)), \alpha(u - v)\rangle \leq \alpha(J(u) - J(v)).
$$

Разделим на $$\alpha$$:
$$
\langle J'(v + \theta\alpha(u - v)), (u - v)\rangle \leq J(u) - J(v).
$$

Перейдем к пределу при $$\alpha \to 0$$ и воспользуемся тем, что $$J \in C^1$$:
$$
\langle J'(v), u - v\rangle \leq J(u) - J(v) \;\; \forall u, v \in U.
$$

$$\Leftarrow$$:
Требуется доказать, что $$J$$ -- выпуклый.

Пусть $$u, v \in U$$: $$u_\alpha = \alpha u + (1 - \alpha)v = v + \alpha(u - v),\; \alpha \in [0,1]$$.

$$
J(u) - J(u_\alpha) \geq \langle J'(u_\alpha), u - u_\alpha \rangle,
$$
$$
J(v) - J(u_\alpha) \geq \langle J'(u_\alpha), v - u_\alpha \rangle.
$$

Умножим первое неравенство на $$\alpha$$, а второе -- на $$1 - \alpha$$ и сложим. Получим
$$
\alpha J(u) + (1 - \alpha)J(v) - J(u_\alpha) \geq
\langle J'(u_\alpha), u_\alpha - u_\alpha\rangle = 0.
$$
Следовательно,
$$
J(u_\alpha) \leq \alpha J(u) + (1 - \alpha)J(v),
$$
что и требовалось доказать.

_Доказательство достаточности._

Требуется доказать, что если $$\langle J'(u_*), u - u_* \rangle \geq 0$$, то $$u_* \in U_*$$.

По доказанному утверждению,
$$
J(u) - J(u_*) \geq \langle J'(u_*), u - u_* \rangle \geq 0.
$$

Следовательно,
$$
J(u) \geq J(u_*) \; \forall u \in U \; \Rightarrow\; u_* \in U_*.
$$

Теорема доказана.

### Условия оптимальности для задачи оптимального управления ДУЧП

$$v_* = \{p_*(t), f_*(x,t) \in V\}$$ -- оптимальное управление, если и только если
$$
\langle J'(v_*), v - v_* \rangle_H \geq 0 \;\; \forall v \in V.
$$

$$
J'(v_*) = \{ a^2\nu\psi(l,t;v_*), \psi(x,t;v_*)\}.
$$
$$
a^2\nu\int_0^T \psi(l,t;v_*)(p(t) - p_*(t))dt + \int_0^T \int_0^l \psi(x,t;v_*)(f(x,t) - f_*(x,t))dxdt \geq 0\;\; \forall v = (p,f) \in V.
$$
Это необходимое и достаточное условие оптимальности.

Другое условие оптимальности:
$$
\int_0^T (u(x,T;v_*) - f(x))u(x,T;v - v_*)dx \geq 0 \;\; \forall v \in V.
$$


## Метод проекции градиента

Источник:

[Frechet Differentiability and Gradient Projection Method - Part 5](https://youtu.be/Vo46DPfj5iU) (Florida Institute of Technology)


### Градиентный метод

$$H$$ -- гильбертово пространство

$$J \colon H \to \mathbb R$$ -- дифференцируем по Фреше

Приращение функционала:
$$
J(v + h) - J(v) = \langle J'(v), h) \rangle + o(h, v), \quad \frac{o(h, v)}{\|h\|} \to 0\; \mbox{при}\; \|h\| \to 0.
$$

$$dJ(v) = \langle J'(v), h\rangle$$ -- главная линейная часть приращения.

По неравенству Коши-Шварца,
$$
-\|J'(v)\|\cdot\|h\| \leq dJ(v) = \langle J'(v), h\rangle \leq \|J'(v)\|\cdot\|h\|
$$

Наибольшее уменьшение функционала в направлении $$h = -\alpha J'(v),\; \alpha \geq 0$$.

Задача: $$J(u) \to \inf$$.

Градиентный метод:
$$
v_{k+1} = v_k - \alpha_k J'(v_k),\; k = 1, 2, \ldots \;(\alpha_k > 0).
$$
Если $$J'(v_k) \neq 0$$, то $$J(v_{k+1}) < J(v_k)$$ для достаточно малых $$\alpha_k$$.

$$
J(v_{k+1}) - J(v_k) = J(v_k - \alpha_k J'(v_k)) - J(v_k) =
\langle J'(v_k), -\alpha_k J'(v_k)\rangle + o(\alpha_k) =
$$
$$
= -\alpha_k\|J'(v_k)\|^2 + o(\alpha_k) = \alpha_k\left[-\|J'(v_k)\|^2 + \frac{o(\alpha_k)}{\alpha_k} \right] < 0, \;\; 0 < \alpha_k \ll 1.
$$



## Метод проекции градиента

Множество допустимых управлений может не совпадать со всем пространством.

Задача: $$J(u) \to \inf, \; u \in U$$ -- выпуклое, замкнутое подмножество гильбертова пространства $$H$$.

Вычисляем $$v_{k+1} = v_k - \alpha_k J'(v_k)$$ и проверяем, принадлежит ли $$v_{k+1}$$ множеству $$U$$. Если нет, то проектируем его обратно на множество $$U$$.

Метод проекции градиента:
$$
v_{k+1} = P_U (v_k - \alpha_k J'(v_k)),\; k = 1, 2, \ldots
$$

#### Оператор проекции

**Определение.** Пусть $$u \in H$$. Тогда $$w \in U$$ называется проекцией $$u$$ на $$U$$ ($$w = P_U(u)$$), если $$\|u - w\| = \inf\limits_{v\in U} \|v - u\|$$.

**Теорема.** Пусть $$U$$ -- выпуклое, замкнутое подмножество гильбертова пространства $$H$$.

Тогда

(1) $$\forall u \in H \; \exists!\, w = P_U(u) \in U$$;

(2) $$w = P_U(u) \Leftrightarrow \langle w - u, v - w \rangle \geq 0,\; \forall v \in U$$;

(3) $$\|P_U(u_1) - P_U(u_2)\| \leq \|u_1 - u_2\| \; \forall u_1, u_2 \in H$$.

**Доказательство.**

Рассмотрим функционал $$g(v) = \|v - u\|^2, v \in U \to \mathbb R$$.
Здесь $$u \in H$$ -- фиксировано.

$$g$$ -- строго выпуклый:
$$
g(\alpha v_1 + (1-\alpha)v_2) = \alpha g(v_1) + (1-\alpha)g(v_2) - \alpha(1-\alpha)\|v_1-v_2\|\; \forall v_1,v_2\in U, \alpha \in [0,1].
$$

Так как $$g$$ сильно выпуклый, $$\exists!\, w \in U : \|v - u\|^2 \geq \|w - u\|^2 \; \forall v \in U \Rightarrow \|v - u\| \geq \|w - u\|$$.

Просто выпуклости недостаточно, контрпример: $$J(u) = 1/u, u \geq 1$$ -- функция выпукла, но не имеет минимума.

(2): $$g \in C^1(U)$$.

$$g(w) = \inf\limits_{v \in U} g(v)$$.

По условиям оптимальности:
$$\langle g'(w), v - w\rangle \geq 0 \; \forall v \in U$$.

$$
\langle 2(w-u), v-w \rangle \geq 0,
$$
$$
\langle w - u, v - w \rangle \geq 0 \; \forall v \in U.
$$
Для выпуклого функционала необходимое условие также является достаточным.

(3): $$u_1, u_2 \in H$$.

$$
\langle P_U(u_1) - u_1, v - P_U(u_1) \rangle \geq 0 \; \forall v \in U,
$$
$$
\langle P_U(u_2) - u_2, v - P_U(u_2) \rangle \geq 0 \; \forall v \in U,
$$
или
$$
\langle u_2 - P_U(u_2), P_U(u_2) - v \rangle \geq 0 \; \forall v \in U.
$$

Сложим 1-е и 3-е неравенства, положив в них $$v = P_U(u_2)$$ и $$v = P_U(u_1)$$ соответственно:
$$
\langle P_U(u_1) - P_U(u_2) - u_1 + u_2, P_U(u_2) - P_U(u_1) \rangle \geq 0
$$
$$
\langle P_U(u_1) - u_1, P_U(u_2) - P_U(u_1) \rangle +
\langle u_2 - P_U(u_2), P_U(u_2) - P_U(u_1) \rangle \geq 0,
$$
$$
\langle P_U(u_2) - P_U(u_1), P_U(u_2) - P_U(u_1) \rangle \leq
\langle u_2 - u_1, P_U(u_2) - P_U(u_1) \rangle.
$$
По неравенству Коши-Шварца:
$$
\|P_U(u_2) - P_U(u_1)\|^2 \leq \|u_1 - u_2\| \|P_U(u_2) - P_U(u_1)\|,
$$
отсюда
$$
\|P_U(u_1) - P_U(u_2)\| \leq \|u_1 - u_2\|.
$$

#### Условия оптимальности

Задача: $$J(u) \to \inf\limits_U$$.

**Теорема.** Пусть $$U$$ -- выпуклое, замкнутое множество гильбертова пространства $$H$$.
Пусть $$J \in C^1(U)$$, $$U_* = \{u \in U \colon J(u) = J_* = \inf\limits_{v \in U} J(v)\} \neq \varnothing$$.

Тогда необходимое условие для $$u_* \in U_*$$:
$$
\tag{*}
u_* = P_U(u_* - \alpha J'(u_*)) \; \forall \alpha \geq 0.
$$
Если $$J$$ -- выпуклый, то (*) -- необходимое и достаточное условие для $$u_* \in U_*$$.

**Доказательство.**

По свойству (2):

$$(*) \Leftrightarrow \langle u_* - (u_* - \alpha J'(u_*)), v - u_* \rangle \geq 0 \; \forall v \in U$$,

$$\langle \alpha J'(u_*), v - u_* \rangle \geq 0 \; \forall v \in U.$$

Получили, что (*) эквивалентно условию оптимальности.

Если $$J$$ -- выпуклый, то это условие оптимальности также достаточное.

Теорема доказана.

Определим оператор $$Au = P_U(u - \alpha J'(u))$$.

Условие оптимальности: $$u_* \in U_* : u_* = Au_*$$ (неподвижная точка).

По свойству (3), $$A$$ -- сжатие.

Метод проекции градиента: $$u_{k+1} = Au_k$$, или $$v_{k+1} = P_U(v_k - \alpha_k J'(v_k)), k = 1, 2, \ldots, \alpha > 0$$.

Остановка, если $$v_{k+1} = v_k = P_U(v_k - \alpha_k J'(v_k))$$.


### Применение метода в задачах оптимального управления

Явная форма оператора проекции.

Пусть $$U = B(\bar u; R) = \{u \in H \colon \|u - \bar u\| \leq R\}$$:
$$
P_U(u) = \begin{cases}
\bar u + R\dfrac{u - \bar u}{\|u - \bar u\|}, && \mbox{если}\; \|u - \bar u\| > R \\
\bar u, && \mbox{если}\; \|u - \bar u\| \leq R.
\end{cases}
$$

_Доказательство._ Требуется доказать, что
$$\left\langle \bar u + R\dfrac{u - \bar u}{\|u - \bar u\|} - u, v - \bar u - R\dfrac{u - \bar u}{\|u - \bar u\|} \right\rangle \geq 0$$.

$$\left\langle \bar u + R\dfrac{u - \bar u}{\|u - \bar u\|} - u, v - \bar u - R\dfrac{u - \bar u}{\|u - \bar u\|} \right\rangle = \left( \dfrac{R}{\|u - \bar u\|} - 1\right)
\left\langle u - \bar u, v - \bar u - R\dfrac{u - \bar u}{\|u - \bar u\|} \right\rangle =
$$
$$
= \left( \dfrac{R}{\|u - \bar u\|} - 1\right)\bigl[ \left\langle u - \bar u, v - \bar u\right\rangle - R\|u - \bar u\| \bigr].
$$

Первый сомножитель отрицателен, т.к. $$\|u - \bar u\| > R$$.

Во втором сомножителе: $$\langle u - \bar u, v - \bar u\rangle \leq \|u - \bar u\| \|v - \bar u\| \leq R\|u - \bar u\|$$, поэтому второй сомножитель также отрицателен.

Следовательно, выражение неотрицательно, что и требовалось доказать.

#### Метод проекции градиента для задачи оптимального управления

$$V = \{v = \{p, f\} \in H = L^2(0,T) \times L^2(Q) \colon
0 < p_{min} \leq p(t) \leq p_{max} \; \mbox{п.в.}\; t \in (0,T),\; \|f\|_{L^2(Q)} \leq R\}$$.

$$
v_{k+1} = P_V (v_k - \alpha_k J'(v_k)), k = 1, 2, \ldots
$$
$$
J'(v_k) = \{a^2\nu\psi(l,t;v_k), \psi(x,t;v_k)\}
$$
$$
f_{k+1}(x,t) = \begin{cases}
f_k(x,t) -\alpha_k\psi(x,t;v_k),&&\mbox{если}\; \int_0^l\int_0^T|f_k(x,t) - \alpha_k\psi(x,t;v_k)|^2\,dtdx \leq R^2,\\
R\dfrac{f_k(x,t) -\alpha_k\psi(x,t;v_k)}{[\int_0^l\int_0^T|f_k(x,t) -\alpha_k\psi(x,t;v_k)|^2\,dxdt]^{1/2}}, && \mbox{если}\; \int_0^l\int_0^T|f_k(x,t) - \alpha_k\psi(x,t;v_k)|^2\,dtdx > R^2.
\end{cases}
$$
$$
p_{k+1}(t) = \begin{cases}
p_k(t) - \alpha_k a^2\nu\psi(l,t;v_k), && \mbox{если}\; p_{min} \leq p_k(t) - \alpha_k a^2\nu\psi(l,t;v_k) \leq p_{max}, \\
p_{min}, && \mbox{если}\; p_k(t) - \alpha_k a^2\nu\psi(l,t;v_k) < p_{min}, \\
p_{max}, && \mbox{если}\; p_k(t) - \alpha_k a^2\nu\psi(l,t;v_k) > p_{max}.
\end{cases}
$$

Как выбирать $$\alpha_k$$?

(1) $$f_k(\alpha_k) = \inf f_k(\alpha), \; f_k(\alpha) = J(P_V(v_k - \alpha J'(v_k)))$$.

(2) Выбрать некоторое $$\alpha > 0$$ такое, что $$J(v_{k+1}) < J(v_k)$$ - при делении $$\alpha$$.

(3) Если $$J(u) \in C^{1,1}(U): \|J'(u) - J'(v)\| \leq L\|u - v\| \; \forall u,v\in V$$, $$0 < \varepsilon_0 \leq \alpha \leq \dfrac{2\varepsilon}{L + \varepsilon}$$:
$$\varepsilon_0, \varepsilon > 0$$ -- фиксированные константы.
