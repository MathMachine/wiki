## Длинные числа

Во [введении](algorithms_introduction.md) мы ввели абстрактный тип
данных "целое число" и структуру данных "32-битное целое число со знаком"
с множеством представимых объектов $$-2^{31}..2^{31}-1$$.
Аналогично можно определить структуру данных "беззнаковое 32-битное целое
число" с множеством представимых объектов $$0 .. 2^{32}-1$$.
Эти структуры данных соответствуют встроенным типам данных в языках
программирования и реализованы в CPU на аппаратном уровне.

Данный раздел посвящен описанию АТД "целое число в $$m$$-ичной системе счисления"
и структуры данных "длинное число по модулю $$m$$".


### 1. АТД "целое число в $m$-ичной системе счисления"

АТД "целое число в $m$-ичной с.с." эквивалентен АТД "целое число" и
конкретизирует способ представления числа в виде последовательности
цифр (элементов алфавита $0 .. m-1$). Таким образом, АТД "целое число
в $m$-ичной с.с." по способу хранения информации эквивалентен АТД
"последовательность типа $0 .. m-1$", но содержит дополнительные операции:
$+, -, \cdot, /$.


### 2. Представление натурального числа в системе счисления по основанию $m$

Для построения СД "длинное число по модулю $$m$$" нужно определить представление
АТД "целое число в $m$-ичной с.с.", то есть взаимно однозначное соответствие
между числами $$\mathbb N$$ и строками $$A^*$$,
где $$A = 0 .. m-1 \equiv \{0, 1, \dots, m-1\}$$, $$A^*$$ -- множество всех
строк, составленных из символов алфавита $$A$$.

Докажем теорему о существовании и единственности такого представления.

**Теорема.** $$\sqsupset m \in \mathbb N, \; m > 1$$.

$$\forall a \in \mathbb N \, \, \exists ! \; \overline{a} \in A^*, \; A = 0 .. m-1$$,

$$\overline{a} = (a_0, a_1, \dots, a_k)$$:

$$a = a_k m^k + a_{k-1} m^{k-1} + \dots + a_1 m + a_0$$,

$$0 \leq a_i < m, \; a_k \neq 0$$.

Строка $$\overline{a}$$ называется представлением числа $$a$$ в с.с.
по основанию $$m$$.

*Доказательство существования.*

Построим алгоритм:

&nbsp;&nbsp;&nbsp; $$i \leftarrow 0$$<br/>
&nbsp;&nbsp;&nbsp; $${\tt \bf while}\; a > 0 \; \{$$<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $$a_i \leftarrow a \;{\rm mod}\; m$$<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $$a \leftarrow [a/m]$$<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $$i \leftarrow i + 1$$<br/>
&nbsp;&nbsp;&nbsp; $$\}$$

Здесь $$a \;{\rm mod}\; m$$ -- остаток от деления $$a$$ на $$m$$,
$$[a/m]$$ -- неполное частное от деления $$a$$ на $$m$$
($$[x]$$ -- целая часть числа $$x$$).

Напомним теорему о делении с остатком.

**Теорема.** [Фаддеев, с. 8]

$$\sqsupset a, b \in \mathbb Z, \; b \neq 0$$.

$$\exists ! \; q, r \in \mathbb Z : a = bq + r, \; 0 \leq r < \vert b \vert$$.

$$q$$ -- неполное частное, $$r$$ -- остаток.
<br/>

Обозначим через $a'$ величину $$a$$ после выполнения одной итерации цикла,
через $$a''$$ -- после двух, $$a'''$$ -- после трех и т.д.,
$$a^{(k)}$$ -- величина $$a$$ после выполнения $$k$$ итераций цикла.

$$a_0 = a\;{\rm mod}\; m, \; a' = [a/m] \; \Rightarrow \; a = a'm + a_0$$,

$$a_1 = a'\;{\rm mod}\; m, \; a'' = [a'/m] \; \Rightarrow \; a' = a''m + a_1$$,

$$a_2 = a''\;{\rm mod}\; m, \; a''' = [a''/m] \; \Rightarrow \; a'' = a'''m + a_2$$,

.$$\dots$$.

$$a_{k-1} = a^{(k-1)} \;{\rm mod}\; m, \; a^{(k)} = [a^{(k-1)}/m] \; \Rightarrow \; a^{(k-1)} = a^{(k)}m + a_{k-1}$$.

Пусть $$k$$ -- наименьший индекс, при котором $$0 < a^{(k-1)} < m$$.
Тогда $$a_k = a^{(k-1)} \;{\rm mod}\; m, \; a^{(k+1)} = [a^{(k)}/m] = 0 \; \Rightarrow \; a^{(k)} = a_k$$.

Заметим, что $$0 < a_k < m, \;\; 0 \leq a_i < m, \; i = 0, \dots, k-1$$.

Вопрос: существует ли такой индекс $$k$$?

Если нет, то $$\exists\, j : a^{(j)} = 0, \; a^{(j-1)} \geq m$$.
Но тогда $$a^{(j)} = [a^{(j-1)}/m] \geq 1$$ -- противоречие.

Вопрос: алгоритм конечен?

$$a > a' > a'' > \dots > a^{(k-1)} > a^{(k)} > a^{(k+1)} = 0$$,
поэтому конечен.

Вопрос: алгоритм находит искомое представление натурального числа в с.с. по
основанию $$m$$?

Имеем

$$a = a'm + a_0$$,

$$a' = a''m + a_1$$,

$$a'' = a'''m + a_2$$,

...

$$a^{(k-1)} = a^{(k)}m + a_{k-1}$$,

$$a^{(k)} = a_k$$.

Отсюда

$$
a = \left( \underbrace{  \left( \underbrace{  \left( \underbrace{ \dots ( \overbrace{ a_k m + a_{k-1} }^{a^{(k-1)}} ) m  \dots  }_{a'''}  \right) m  + a_2 }_{a''}  \right) m + a_1  }_{a'} \right) m + a_0 =
$$

$$
= a_0 + a_1 m + a_2 m^2 + a_3 m^3 + \dots + a_{k-1} m^{k-1} + a_k m^k,
$$
причем $$0 \leq a_i < m, \; a_k \neq 0$$.

Следовательно,
$$\overline{a} = (a_0, a_1, \dots, a_k) \in A^{k+1} \subset A^* $$ --
представление числа $$a$$ в с.с. по основанию $$m$$.
Существование доказано.

*Доказательство единственности.*
На самостоятельный анализ [Андреева, с. 20].


Итак, мы построили взаимно однозначное соответствие между всеми числами
$\mathbb N$ и строками $A^* $, $A = 0 .. m-1$, с ненулевым последним
элементом. Поэтому с числами мы можем работать, как со строками, и со строками,
как с числами.

Алгоритм, приведенный в доказательстве теоремы, позволяет перевести любое число
$a \in \mathbb N$ в $m$-ичную систему счисления при помощи операций
деления нацело и взятия остатка от деления.

### 3. Преобразование АТД "целое число в $p$-ичной с.с." в АТД "целое число в $q$-ичной с.с."


### Литература

[Андреева] [Андреева, Босова, Фалина -- Математические основы информатики (2005)](https://yadi.sk/i/R89HOZ6aXeAIMQ)

[Фаддеев] [Фаддеев -- Лекции по алгебре (2007)](https://yadi.sk/i/KNQK1G-RqgFEDA)
